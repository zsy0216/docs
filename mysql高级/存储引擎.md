# Mysql的存储引擎

## 查看mysql的存储引擎

命令：

```shell
SHOW ENGINES;
```

![](https://raw.githubusercontent.com/zsy0216/image/master/notes/20191210205002.png)

## 各个引擎简介

### InnoDB

从MySQL5.5版本之后，MySQL的默认内置存储引擎是InnoDB（之前是MyISAM）。

InnoDB是MySQL的默认事务型引擎，它被设计用来处理大量的短期(short-lived)事务。除非有非常特别的原因需要使用其他的存储引擎，否则应该优先考虑InnoDB引擎。

主要特点：

- 灾难恢复性比较好；
- 支持事务。默认的事务隔离级别为可重复度，通过MVCC（并发版本控制）来实现的。
- 使用的锁粒度为行级锁，可以支持更高的并发；
- 支持外键；
- 配合一些热备工具可以支持在线热备份；
- 在InnoDB中存在着缓冲管理，通过缓冲池，将索引和数据全部缓存起来，加快查询的速度；
- 对于InnoDB类型的表，其数据的物理组织形式是聚簇表。所有的数据按照主键来组织。数据和索引放在一块，都位于B+数的叶子节点上；

### MyISAM存储引擎

MyISAM提供了大量的特性，包括全文索引、压缩、空间函数(GIS)等，但MyISAM不支持事务和行级锁，有一个毫无疑问的缺陷就是崩溃后无法安全恢复。

主要特点：

- 不支持事务；
- 不支持外键，如果强行增加外键，不会提示错误，只是外键不其作用；
- 对数据的查询缓存只会缓存索引，不会像InnoDB一样缓存数据，而且是利用操作系统本身的缓存；
- 默认的锁粒度为表级锁，所以并发度很差，加锁快，锁冲突较少，所以不太容易发生死锁；
- 支持全文索引（MySQL5.6之后，InnoDB存储引擎也对全文索引做了支持），但是MySQL的全文索引基本不会使用，对于全文索引，现在有其他成熟的解决方案，比如：ElasticSearch，Solr，Sphinx等。
- 数据库所在主机如果宕机，MyISAM的数据文件容易损坏，而且难恢复；

### Archive引擎

Archive档案存储引擎只支持 INSERT 和 SELECT 操作，在MySQL5.1之前不支持索引。

Archive表适合日志和数据采集类应用。

根据英文的测试结论来看，Archive表比MyISAM表要小大约75%，比支持事务的InnoDB表小大约83%。

### Blackhole引擎

Blackhole引擎没有实现任何存储机制，它会丢弃所有插入的数据，不做任何保存。但服务器会记录Blackhole表的日志，所以可以用于复制数据到备库，或者简单地记录到日志。但这种应用方式会碰到很多问题，因此并不推荐。

### CSV引擎

CSV引擎可以将普通的CSV文件作为MySQL的表来处理，但不支持索引；

CSV引擎可以作为一种数据交换的机制，非常有用。

## MyISAM和InnoDB对比

| 对比项         | MyISAM                                                   | InnoDB                                                       |
| -------------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| 外键           | 不支持                                                   | 支持                                                         |
| 事务           | 不支持                                                   | 支持                                                         |
| 行表锁         | 表锁，即使操作一条记录也会锁住整个表，不适合高并发的操作 | 行锁，操作时只锁某一行，不对其他行有影响<br />适合高并发的操作 |
| 缓存           | 只缓存索引，不缓存真实数据                               | 不仅缓存索引还要缓存真实数据，对内存要求较高，而且内存大小对性能有决定性的影响 |
| 关注点         | 节省资源、消耗少、简单业务                               | 并发写、事务、更大资源                                       |
| 默认安装       | Y                                                        | Y                                                            |
| 默认使用       | N                                                        | Y                                                            |
| 自带系统表使用 | Y                                                        | N                                                            |

